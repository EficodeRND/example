devTestHelper:
  handler: lambdas/dev/test_helper.handler
  enabled: '"${self:provider.stage}" != "prod"'
  layers:
    - !Ref CommonLambdaLayer
    - !Ref AppLambdaLayer
  iamRoleStatements:
    - Effect: "Allow"
      Action:
        - cognito-idp:AdminCreateUser
        - cognito-idp:AdminDeleteUser
        - cognito-idp:AdminAddUserToGroup
        - cognito-idp:AdminSetUserPassword
      Resource: !GetAtt CognitoUserPoolUserPool.Arn
    - Effect: "Allow"
      Action:
        - secretsmanager:GetSecretValue
      Resource: !Ref DBAppSecret
  package:
    patterns:
      - 'lambdas/dev/test_helper.py'
      - 'lambdas/models.py'
      - 'lambdas/dao/**'
      - 'lambdas/services/**'
      - 'lambdas/utils/dev_utils.py'
      - '!**/__pycache__/**'
  environment:
    USERPOOL_ID:
      Ref: CognitoUserPoolUserPool
    CLIENT_ID:
      Ref: UserClient
    DB_APP_SECRET_ARN:
      Ref: DBAppSecret
